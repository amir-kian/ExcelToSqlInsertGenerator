<Window x:Class="ExcelToSqlInsertGenerator.MainWindow"
        x:Name="RootWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ExcelToSqlInsertGenerator"
        mc:Ignorable="d"
        Title="Excel to SQL INSERT Generator" Height="700" Width="900"
        MinHeight="500" MinWidth="700">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="2*" MinHeight="120"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*" MinHeight="120"/>
            <RowDefinition Height="*" MinHeight="100"/>
        </Grid.RowDefinitions>

        <!-- Step 1: Sample INSERT -->
        <GroupBox Grid.Row="0" Header="1. Sample INSERT statement" Margin="0,0,0,8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="100"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Text="Paste your INSERT with placeholders like &lt;ColumnName, sql_type&gt; (e.g. &lt;Name, nvarchar(200)&gt;)" 
                          TextWrapping="Wrap" Margin="4" Foreground="#444"/>
                <TextBox x:Name="TxtInsertTemplate" Grid.Row="1" 
                         AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"
                         FontFamily="Consolas" FontSize="12" Padding="6"
                         Margin="4" VerticalContentAlignment="Top"/>
                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="4">
                    <Button x:Name="BtnParse" Content="Parse template" Click="BtnParse_Click" Padding="12,6" Margin="0,0,8,0"/>
                    <TextBlock x:Name="TxtParseStatus" VerticalAlignment="Center" Foreground="Gray"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- Step 2: Excel file -->
        <GroupBox Grid.Row="1" Header="2. Excel file" Margin="0,0,0,8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="TxtExcelPath" Grid.Column="0" IsReadOnly="True" Padding="6" Margin="4" VerticalContentAlignment="Center"/>
                    <Button x:Name="BtnLoadExcel" Grid.Column="1" Content="Browse..." Click="BtnLoadExcel_Click" Padding="12,6" Margin="4"/>
                </Grid>
                <ProgressBar x:Name="ExcelProgressBar" Grid.Row="1" Height="4" Margin="4,0" IsIndeterminate="True" Visibility="Collapsed"/>
                <TextBlock x:Name="TxtExcelStatus" Grid.Row="2" Margin="4" TextWrapping="Wrap" Visibility="Collapsed"
                           Foreground="#333" VerticalAlignment="Center"/>
            </Grid>
        </GroupBox>

        <!-- Step 3: Map INSERT values to Excel columns -->
        <GroupBox x:Name="GroupMapping" Grid.Row="2" Header="3. Map each INSERT value to an Excel column" Margin="0,0,0,8" Visibility="Collapsed">
            <DataGrid x:Name="GridMappings" AutoGenerateColumns="False" CanUserAddRows="False" 
                      HeadersVisibility="Column" Margin="4" MinHeight="100"
                      SelectionMode="Single" SelectionUnit="Cell">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="INSERT column" Binding="{Binding ColumnName}" Width="140" IsReadOnly="True"/>
                    <DataGridTextColumn Header="SQL type" Binding="{Binding SqlType}" Width="120" IsReadOnly="True"/>
                    <DataGridTemplateColumn Header="Source (Excel column or Your own value)" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ComboBox ItemsSource="{Binding MappingOptions, ElementName=RootWindow}"
                                          SelectedItem="{Binding SelectedExcelColumn, UpdateSourceTrigger=PropertyChanged}"
                                          IsEditable="False" Margin="2"
                                          ToolTip="Select Excel column, '(Custom text)' for fixed value, or '(Condition)' to use When value = ... use"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Your own value (when Source = Custom text)" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBox Text="{Binding FixedValue, UpdateSourceTrigger=PropertyChanged}" 
                                         Margin="2"
                                         ToolTip="Type the exact SQL to insert (e.g. 1, 0, NULL, GETDATE(), NEWID(), N'constant'). Used for every row when Source is Custom text."/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="When value = ... use (e.g. 1=N'Man';2=N'Woman')" Width="220">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBox Text="{Binding ValueMap, UpdateSourceTrigger=PropertyChanged}" 
                                         Margin="2"
                                         ToolTip="When Source=(Condition): uses value from Excel column with same name as INSERT column; if it equals X use SQL Y. Format: 1=N'Man';2=N'Woman'"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- Generate -->
        <Grid Grid.Row="3" Margin="0,0,0,8">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <StackPanel Grid.Row="0" Orientation="Horizontal">
                <Button x:Name="BtnGenerate" Content="Generate INSERT script" Click="BtnGenerate_Click" Padding="14,8" Margin="0,0,8,0" IsEnabled="False"/>
                <Button x:Name="BtnCopy" Content="Copy to clipboard" Click="BtnCopy_Click" Padding="14,8" Margin="0,0,8,0" IsEnabled="False"/>
                <Button x:Name="BtnSave" Content="Save to file..." Click="BtnSave_Click" Padding="14,8" Margin="0,0,8,0" IsEnabled="False"/>
                <Button x:Name="BtnCancelSave" Content="Cancel save" Click="BtnCancelSave_Click" Padding="14,8" Margin="0,0,8,0" Visibility="Collapsed" ToolTip="Cancel the save in progress"/>
                <Button x:Name="BtnReset" Content="Reset" Click="BtnReset_Click" Padding="14,8" Margin="0,0,0,0" ToolTip="Clear mapping selections and generated SQL"/>
                <TextBlock Text="Chunk size (0 = whole file):" VerticalAlignment="Center" Margin="16,0,4,0"/>
                <TextBox x:Name="TxtChunkSize" Width="60" Padding="4,2" VerticalContentAlignment="Center" Text="0" ToolTip="When saving: 0 = single file; &gt;0 = split into multiple files with N inserts each"/>
            </StackPanel>
            <ProgressBar x:Name="GenerateProgressBar" Grid.Row="1" Height="6" Margin="0,4,0,0" Minimum="0" Maximum="100" Value="0" Visibility="Collapsed" IsIndeterminate="False"/>
            <TextBlock x:Name="TxtGenerateStatus" Grid.Row="2" Margin="0,4,0,0" TextWrapping="Wrap" Visibility="Collapsed"
                       Foreground="#333" VerticalAlignment="Center"/>
        </Grid>

        <!-- Output -->
        <GroupBox Grid.Row="4" Header="Generated SQL">
            <TextBox x:Name="TxtOutput" IsReadOnly="True" AcceptsReturn="True" TextWrapping="NoWrap" 
                     HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto"
                     FontFamily="Consolas" FontSize="12" Padding="6"/>
        </GroupBox>

        <!-- Execute to database -->
        <GroupBox Grid.Row="5" Header="4. Execute to database" Margin="0,8,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*" MinHeight="80"/>
                </Grid.RowDefinitions>
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Connection string:" VerticalAlignment="Center" Margin="4"/>
                    <TextBox x:Name="TxtConnectionString" Grid.Column="1" Padding="6" Margin="4" VerticalContentAlignment="Center"
                             ToolTip="e.g. Server=.;Database=MyDb;Trusted_Connection=True;TrustServerCertificate=True"/>
                    <Button x:Name="BtnValidate" Grid.Column="2" Content="Validate before Execute" Click="BtnValidate_Click" Padding="12,6" Margin="4" IsEnabled="False"
                            ToolTip="Check all rows for problems (bad data, Excel errors) without connecting to DB"/>
                    <Button x:Name="BtnExecute" Grid.Column="3" Content="Execute INSERTs" Click="BtnExecute_Click" Padding="12,6" Margin="4" IsEnabled="False"
                            ToolTip="Generate and execute each INSERT from Excel data (no need to Generate first)"/>
                    <Button x:Name="BtnCancelExecute" Grid.Column="4" Content="Cancel" Click="BtnCancelExecute_Click" Padding="12,6" Margin="4"
                            Visibility="Collapsed" ToolTip="Cancel execution"/>
                </Grid>
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="4,2">
                    <TextBlock Text="Start row (0 = beginning):" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBox x:Name="TxtExecuteStartRow" Width="70" Padding="4,2" VerticalContentAlignment="Center" Text="0" ToolTip="Resume from this row index (0-based) after a crash"/>
                    <TextBlock Text="Skip rows (0 = none):" VerticalAlignment="Center" Margin="8,0,4,0"/>
                    <TextBox x:Name="TxtExecuteSkipRows" Width="50" Padding="4,2" VerticalContentAlignment="Center" Text="0" ToolTip="Skip this many rows from Start row. Use 500â€“1000 to jump past a bad range that keeps crashing."/>
                    <Button x:Name="BtnResumeFromCheckpoint" Content="Resume from checkpoint" Click="BtnResumeFromCheckpoint_Click" Padding="8,4" Margin="8,0,0,0" ToolTip="Read last saved row from checkpoint file. If it crashes again at same spot, add Skip rows (e.g. 500) to jump past."/>
                    <CheckBox x:Name="ChkExecuteParallel" Content="Process in parallel" IsChecked="False" VerticalAlignment="Center" Margin="16,0,8,0" ToolTip="Divide rows into chunks and process chunks concurrently. Requires Chunk size &gt; 0."/>
                    <TextBlock Text="Chunk size:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBox x:Name="TxtExecuteChunkSize" Width="70" Padding="4,2" VerticalContentAlignment="Center" Text="50000" ToolTip="Rows per chunk. Sequential: 0 = all. Parallel: required &gt; 0 (e.g. 50000)."/>
                </StackPanel>
                <ProgressBar x:Name="ExecuteProgressBar" Grid.Row="2" Height="4" Margin="4,0" Minimum="0" Maximum="100" Value="0" Visibility="Collapsed"/>
                <TextBlock x:Name="TxtExecuteStatus" Grid.Row="3" Margin="4" TextWrapping="Wrap" Visibility="Collapsed" Foreground="#333"/>
                <TextBox x:Name="TxtExecuteLog" Grid.Row="4" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto" FontFamily="Consolas" FontSize="11" Padding="6" Margin="4"
                         VerticalContentAlignment="Top" ToolTip="Log: inserted count, failed count, and failed row IDs"/>
            </Grid>
        </GroupBox>
    </Grid>
</Window>
